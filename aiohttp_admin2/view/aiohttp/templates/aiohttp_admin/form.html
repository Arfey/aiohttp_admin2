{% from 'aiohttp_admin/field.html' import field_generator %}

{% macro form(
    action,
    controller_view,
    mapper=None,
    fields=None,
    method='POST',
    submit_text='submit',
    submit_cls='',
    exclude=[]
)
%}
<div>
    <form method="{{ method }}" action="{{ action }}">
        {% if mapper %}
        {% if fields == '__all__' %}

        {% for name, field in mapper.fields.items() %}
            {% if name not in exclude %}
                {{ field_generator(name, field, controller_view) }}
            {% endif %}
        {% endfor %}

        {% else%}

        {% for name, field in mapper.fields.items() %}
            {% if name not in exclude %}
                {{ field_generator(name, field, controller_view) }}
            {% endif %}
        {% endfor %}

        {% endif %}
        {% endif %}
        {% if mapper.error %}
        <br>
        <span style="color: red">{{ mapper.error }}</span>
        <br>
        {%- endif %}
        <button class="btn {{ submit_cls }}" type="submit">{{ submit_text }}</button>
    </form>
</div>
{% endmacro %}
